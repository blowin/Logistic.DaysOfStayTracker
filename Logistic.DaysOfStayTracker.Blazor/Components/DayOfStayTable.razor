@using Microsoft.VisualBasic
@using Constants = Logistic.DaysOfStayTracker.Core.Constants

<MudGrid>
    <MudItem Class="pt-5" xs="12">
        <MudText Typo="Typo.h5">Дни пребывания</MudText>
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="AddDayOfStay">+</MudButton>
    </MudItem>
    @if (_errors != null)
    {
        <MudItem xl="12" xs="12" xxl="12">
            @foreach (var error in _errors)
            {
                <MudText Color="Color.Error">@error</MudText>
            }
        </MudItem>
    }
    <MudItem xs="4">
        <MudDatePicker @ref="_pickerStart" @bind-Date="SearchRequest.Start" Label="Дата въезда" AutoClose="true">
            <PickerActions>
                <MudButton Class="mr-auto align-self-start" OnClick="@(() => _pickerStart.Clear())">Удалить</MudButton>
            </PickerActions>
        </MudDatePicker>
    </MudItem>
    <MudItem xs="4">
        <MudDatePicker @ref="_pickerEnd" @bind-Date="SearchRequest.End" Label="Дата выезда" AutoClose="true">
            <PickerActions>
                <MudButton Class="mr-auto align-self-start" OnClick="@(() => _pickerEnd.Clear())">Удалить</MudButton>
            </PickerActions>
        </MudDatePicker>
    </MudItem>
    <MudItem xs="4">
        <MudDatePicker @ref="_pickerYear" Label="Год" @bind-Date="SearchRequest.Year" OpenTo="OpenTo.Year" FixDay="1" DateFormat="yyyy" AutoClose="true">
            <PickerActions>
                <MudButton Class="mr-auto align-self-start" OnClick="@(() => _pickerYear.Clear())">Удалить</MudButton>
                <MudButton Color="Color.Primary" OnClick="@(() => _pickerYear.Close())">Сохранить</MudButton>
            </PickerActions>
        </MudDatePicker>
    </MudItem>
    <MudItem xl="12" xs="12" xxl="12">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await SearchAsync())">Найти</MudButton>
        @if (_calculateRemainDaysResponse != null)
        {
            <MudItem xs="4">
                <MudText>В настоящее время @_calculateRemainDaysResponse.RemainDays дней.</MudText>
                <MudText>C @_calculateRemainDaysResponse.DateOfAddDays будет добавляться @_calculateRemainDaysResponse.AddDays дней.</MudText>
            </MudItem>
        }
    </MudItem>

    <MudItem xl="12" xs="12" xxl="12">
        <MudTable Items="@_items" Hover="true" Breakpoint="Breakpoint.Md" LoadingProgressColor="Color.Info">
            <HeaderContent>
                <MudTh>Дата въезда</MudTh>
                <MudTh>Страна въезда</MudTh>
                <MudTh>Дата выезда</MudTh>
                <MudTh>Страна выезда</MudTh>
                <MudTh>Действия</MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Дата въезда">@context.EntryDate</MudTd>
                <MudTd DataLabel="Страна въезда">@(_countries[context.EntryCountryId].Name)</MudTd>
                <MudTd DataLabel="Дата выезда">@context.ExitDate</MudTd>
                <MudTd DataLabel="Страна выезда">@(_countries[context.ExitCountryId].Name)</MudTd>
                <MudTd>
                    <MudButton Color="Color.Primary" OnClick="@(() => Delete(context))">Удалить</MudButton>
                </MudTd>
            </RowTemplate>
            <PagerContent>
                <MudTablePager Class="pa-4" PageSizeOptions="@(new[] {Constants.DefaultPageSize})" HideRowsPerPage="true"/>
            </PagerContent>
        </MudTable>
    </MudItem>
</MudGrid>