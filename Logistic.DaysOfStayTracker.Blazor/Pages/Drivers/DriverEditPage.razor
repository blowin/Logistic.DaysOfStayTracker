@page "/driver/{Id:guid?}"

<MudGrid>
    <MudItem xl="12" xs="12" xxl="12">
        <MudTabs Elevation="4" Rounded="true" Centered="true">
            <MudTabPanel Text="Водитель">
                <MudCard>
                    <MudForm Model="@_model" Style="min-height: 200px;">
                        <MudCardContent>
                            <MudItem xl="12" xs="12" xxl="12">
                                @foreach (var error in _errors)
                                {
                                    <MudText Color="Color.Error">@error</MudText>
                                }
                            </MudItem>
                            <MudItem xs="4">
                                <MudTextField @bind-Value="_model.FirstName" For="@(() => _model.FirstName)" Immediate="true" Label="Имя"></MudTextField>
                            </MudItem>
                            <MudItem xs="4">
                                <MudTextField @bind-Value="_model.LastName" For="@(() => _model.LastName)" Immediate="true" Label="Фамилия"></MudTextField>
                            </MudItem>
                        </MudCardContent>
                    </MudForm>
                    <MudCardActions Class="pt-3">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await Submit())">Сохранить</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudTabPanel>
            <MudTabPanel Text="Даты">
                <MudCard>
                    <MudGrid Class="mt-4 my-4">
                        <MudItem xl="12" xs="12" xxl="12">
                            @foreach (var error in _errors)
                            {
                                <MudText Color="Color.Error">@error</MudText>
                            }
                        </MudItem>
                        <MudItem xs="4">
                            <MudDatePicker @ref="_pickerStart" @bind-Date="_dayOfStaySearchRequest.Start" Label="Start" AutoClose="true">
                                <PickerActions>
                                    <MudButton Class="mr-auto align-self-start" OnClick="@(() => _pickerStart.Clear())">Удалить</MudButton>
                                </PickerActions>
                            </MudDatePicker>
                        </MudItem>
                        <MudItem xs="4">
                            <MudDatePicker @ref="_pickerEnd" @bind-Date="_dayOfStaySearchRequest.End" Label="End" AutoClose="true">
                                <PickerActions>
                                    <MudButton Class="mr-auto align-self-start" OnClick="@(() => _pickerEnd.Clear())">Удалить</MudButton>
                                </PickerActions>
                            </MudDatePicker>
                        </MudItem>
                        <MudItem xs="4">
                            <MudDatePicker @ref="_pickerYear" Label="Год" @bind-Date="_dayOfStaySearchRequest.Year" OpenTo="OpenTo.Year" FixDay="1" DateFormat="yyyy" AutoClose="true">
                                <PickerActions>
                                    <MudButton Class="mr-auto align-self-start" OnClick="@(() => _pickerYear.Clear())">Удалить</MudButton>
                                    <MudButton Color="Color.Primary" OnClick="@(() => _pickerYear.Close())">Сохранить</MudButton>
                                </PickerActions>
                            </MudDatePicker>
                        </MudItem>
                        <MudItem xl="12" xs="12" xxl="12">
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await SearchStayOfDateAsync())">Найти</MudButton>
                            <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await CalculateRemainDaysAsync())">Подсчитать дни пребывания</MudButton>
                            @if (_calculateRemainDaysResponse != null)
                            {
                                <MudItem xs="4">
                                    <MudText>В настоящее время @_calculateRemainDaysResponse.RemainDays дней.</MudText>
                                    <MudText>C @_calculateRemainDaysResponse.DateOfAddDays будет добавляться @_calculateRemainDaysResponse.AddDays дней.</MudText>
                                </MudItem>
                            }
                        </MudItem>
                        <MudItem xl="12" xs="12" xxl="12">
                            <DayOfStayTable @ref="_dayOfStayTable" SearchRequest="_dayOfStaySearchRequest"></DayOfStayTable>
                        </MudItem>
                    </MudGrid>
                    <MudCardActions Class="pt-3">
                        <MudButton Variant="Variant.Filled" Color="Color.Primary" Class="ml-auto" OnClick="@(async () => await Submit())">Сохранить</MudButton>
                    </MudCardActions>
                </MudCard>
            </MudTabPanel>
        </MudTabs>
    </MudItem>
</MudGrid>
